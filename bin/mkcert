#!/usr/bin/env bash
PROJECT_DIR=$(realpath "$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"/..)
CURRENT_DIR=$(pwd)

mkdir -p "$PROJECT_DIR"/bin/.mkcert

# IF we are running this script from within Git Bash for Windows...
if [[ "$(uname)" = MINGW64_NT* ]]; then
    # ...THEN disable automatic path prefixing
    # NOTE: Otherwise paths starting with / are prefixed with "C:\Program Files\Git"
    export MSYS_NO_PATHCONV=1

    if [ ! -f "$PROJECT_DIR"/bin/.mkcert/mkcert.exe ]; then
        # cURL in Git Bash seems to not be able to download to hidden directories
        cd "$PROJECT_DIR"/bin/.mkcert && curl -JL https://dl.filippo.io/mkcert/latest?for=windows/amd64 -o mkcert.exe
        cd "$CURRENT_DIR" || exit
    fi

    "$PROJECT_DIR"/bin/.mkcert/mkcert.exe "$@"

else
    if [ ! -f "$PROJECT_DIR"/bin/.mkcert/mkcert ]; then
        curl -JL https://dl.filippo.io/mkcert/latest?for=linux/amd64 -o "$PROJECT_DIR"/bin/.mkcert/mkcert
    fi

    "$PROJECT_DIR"/bin/.mkcert/mkcert "$@"
fi




